<% content_for :page_title do %>Signup<% end %>

<div class="joinpage">

	
<% if flash[:error] %>
	<div id="flash-error">
	<%= flash[:error] %>
	</div>
<% end %>
	
	<div class="title">Welcome!</div>
	<div class="message">Join for free and share your photos.</div>
	<div class="formcontainer">
    <form class="join-form" method="post" enctype="multipart/form-data" action="<%=create_user_url%>" >
      <input style="visibility:hidden" type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>"/>
      <ul>
        <li>
          <label for="user_name" >First &amp; Last Name</label>
          <input type="text" name="user[name]" id="user_name" value="<%=(@new_user ? @new_user.name : '')%>" />
          
        </li>
        <li>
          <label for="user_username">Username</label>
          <input type="text" name="user[username]" id="user_username" value="<%=(@new_user ? @new_user.username: '')%>" />
        </li>
        <li>
          <label for="user_email">Email address</label>
          <input type="text" name="user[email]" id="user_email" value="<%=(@new_user ? @new_user.email: '')%>" />
        </li>
        <li>
          <label for="user_password">Password</label>
          <input type="password" name="user[password]" id="user_password" value="" maxlength="40" />
        </li>
        <li>
			<input type="submit" id="submit" value="Join for Free" />
        </li>
        <li>
          By joining you accept and agree to <a target="_blank" href="/terms">the terms of service</a>.
        </li>
      </ul>
    </form>
   </div>

	<div class="afterform">
		Not Sure? <a href="/">Learn More</a>
	</div>
	
</div>

<% content_for :page_javascript do %>
<script type="text/javascript">
$(document).ready(function(){
	zz.toolbars.hide_bottom_toolbar();

    zz.local_storage.clear();
	
    zz.joinform.add_validation( $('.join-form') );

	$('.join-form li label').inFieldLabels();

    $('.submit-button').click(function(){
        submit_form();
    });

    $('.join-form').bind('keypress', function(e){
        if ( e.keyCode == 13 ) {
            submit_form();
        }
    });

    $('#user_name').focus();

    ZZAt.track('page.join.visit');
});

function submit_form(){
	if($('.join-form').valid()){
    	$(".join-form").submit();
        //ZZAt.track('button.join.click');
		ZZAt.track("join.joinpage.click");
		ZZAt.track("join.joinpage.click.valid");
	} else {
        var num_fields_nonempty = 0;
        var num_fields_valid = 0;
        var bit_notation = 0;
        
        num_fields_nonempty =
            ($('#user_name').val().length != 0) +
            ($('#user_username').val().length != 0) +
            ($('#user_email').val().length != 0) +
            ($('#user_password').val().length != 0);
            
        bit_notation = 
            1 * $('#user_name').valid() +
            2 * ($('#user_name').val().length != 0) + 
            4 * $('#user_username').valid() +
            8 * ($('#user_username').val().length != 0) + 		
            16 * $('#user_email').valid() +
            32 * ($('#user_email').val().length != 0) + 		
            64 * $('#user_password').valid() +
            128 * ($('#user_password').val().length != 0);			

        num_fields_valid = 
            $('#user_name').valid() + 
            $('#user_username').valid() + 
            $('#user_email').valid() + 
            $('#user_password').valid();
            
        ZZAt.track("join.joinpage.click");
        ZZAt.track("join.joinpage.invalid", {
            Zjoin_num_fields_nonempty: num_fields_nonempty,
            Zjoin_num_fields_valid: num_fields_valid,
            Zjoin_bit_fields: bit_notation
			});
	}
}
</script>
<% end %>
