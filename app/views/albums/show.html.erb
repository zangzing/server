<!-- The album JSON is stored in a golobal variable for processing in onLoad -->
<script> albumJSON = '<%=@album.to_json(:include => {:photos => {:only =>[:id], :methods => [:thumb_url]}})%>' </script>

<h2 class="album"><%= h @album.name %></h2>
<table class="profile">
  <tr>
    <td class="main">
      <% unless @album.photos.empty? %>
        <table class="photos">
	        <%= render @photos %>
        </table>
        <%= will_paginate @photos %>
      <% end %>

      <!-- This form is the html photo upload. Its replaced by the uploader button at runtime if agent is present -->
      <div id="uploadform">
        <%form_for [@album, @photo], :url => album_photos_path(@album), :html => { :multipart => true } do |f| %>
            <%= f.error_messages %>
            <div class="field">
                <%= f.file_field :image %>
                <%= f.submit "Add Photo"%>
            </div>
        <% end %>
      </div>


    </td>
  </tr>
</table>

<script>
    //create script to detect agent...and call onAgentDetected()
    //var urlBase = location.href.substring(0,location.href.lastIndexOf("/"));
    var agentPresent = false;
    var urlBase = "http://" + location.host;
    var e = document.createElement("script");
    e.src = "http://localhost:9090/proxy/" + urlBase + "/uploader/detect-agent.js";
    e.type="text/javascript";
    document.getElementsByTagName("head")[0].appendChild(e);

    function onAgentDetected()
    {
        agentPresent = true;
        $("#uploadform").html('<%= button_to "Upload Photos", upload_path( @album.id ), :method => :get %>');
    }
</script>
