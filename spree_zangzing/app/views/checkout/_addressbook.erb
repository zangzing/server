<% # Locals are:
   #     order: the order for which the addressbook should be displayed
   #     address_id_field_name: the name for the field where the address id will be passed
   #     button_text: the text to be shown in the address button
   #     form_id:     the id of the form being used
%>

<% column_width = 4 %>

<% if order.user && order.user.addresses.count > 0  %>
<script type="text/javascript">
  function append_hidden_address( form_id ,address_field_name, id ){
    var input = $('<input/>')
            .attr({ 'type' : 'hidden',
                    'name' : address_field_name,
                    'value': id
            });
    $('#'+form_id).append( input );
  }
</script>
    <b>Address Book</b>
    <table>
      <% column = 0 %>
      <% order.user.addresses.each do |address| %>
          <%if column % column_width == 0 %>
            <tr>
          <%end%>
          <td>
            <%#= form_for order, :url => update_checkout_path(order.state), :html => { :method => :post, :class => "button-to", :id => "address_#{address.id}" } do |adf| %>
                <%= form.submit button_text,
                         {:onclick => "append_hidden_address( '#{form_id}', '#{address_id_field_name}', '#{address.id}')"} %>
            <%#end%>
            <%= render :partial =>'address_display', :locals => { :address => address,:label =>"" } %>
            <a href="javascript:void(0)"><span>edit</span></a> <a href="javascript:void(0)"><span>delete</span></a>
          </td>
          <%if column %column_width == column_width-1 %>
          </tr>
          <%end%>
          <% column = column + 1 %>
      <%end %>
    </table>
<%end %>

