<html>
<head>

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
        <link href="token-input.css" rel="stylesheet" type="text/css" />
        <link href="token-input-facebook.css" rel="stylesheet" type="text/css" />
        <link href="/stylesheets/main.css" rel="stylesheet" type="text/css" />
        <link href="/stylesheets/contacts.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="/javascripts/jquery-lib/jquery.cookie.js"></script>
        <script type="text/javascript" src="/javascripts/jquery-lib/jquery.jsonp.js"></script>
        <script type="text/javascript" src="/javascripts/zz/logging.js"></script>
        <script type="text/javascript" src="/javascripts/zz-oauthmanager/oauthmanager.js"></script>
        <script type="text/javascript" src="/javascripts/zz/agent.js"></script>
        <script type="text/javascript" src="jquery.tokeninput.js"></script>
        <script type="text/javascript" src="contacts.js"></script>

</head>
<body>
<H1>ZZ Autocomplete Tokenizer Testing</H1>

  <script type="text/javascript">

  </script>

<div >
<div  align="left" style="margin: 30px;">
<a data-service="google" class="gray-button contacts-btn" href="javascript:void(0);return false;"><span><div class="off"></div>Google</span></a>
<a data-service="local"  class="gray-button contacts-btn" href="javascript:void(0);return false;"><span><div class="off"></div>Local</span></a>
<a data-service="yahoo"  class="gray-button contacts-btn" href="javascript:void(0);return false;"><span><div class="off"></div>Yahoo</span></a>
<a data-service="mslive" class="gray-button contacts-btn" href="javascript:void(0);return false;"><span><div class="off"></div>MSLive</span></a>
</div>

<form id="contacts_form" action="/albums/29900073855/contributors" method="post">
    <div class="tokenizer">
        <input type="text" id="contacts" name="contact_list" />
    </div>
    <input id="contacts_submit" type="submit" name="mysubmit" value="Click To Add Contributors!" />
</form>
 </div>

<div>
    <div class="tokenizer">
        <input type="text" id="users" name="contact_list" />
    </div>
</div>



<script type="text/javascript">
$(function(){
    zz={};
    zz.current_user_id ='249900073725';
    var url = '/albums/29900073855/contributors';

      $("#contacts").tokenInput( zzcontacts.find, {
         allowNewValues: true,
         classes: {
            tokenList: "token-input-list-facebook",
            token: "token-input-token-facebook",
            tokenDelete: "token-input-delete-token-facebook",
            selectedToken: "token-input-selected-token-facebook",
            highlightedToken: "token-input-highlighted-token-facebook",
            dropdown: "token-input-dropdown-facebook",
            dropdownItem: "token-input-dropdown-item-facebook",
            dropdownItem2: "token-input-dropdown-item2-facebook",
            selectedDropdownItem: "token-input-selected-dropdown-item-facebook",
            inputToken: "token-input-input-token-facebook"
         }
      });

    $("#users").tokenInput( zzcontacts.find, {
                            allowNewValues: false,
                            displayOnly : true,
                            classes: {
                                tokenList: "token-input-list-facebook",
                                token: "token-input-token-facebook",
                                tokenDelete: "token-input-delete-token-facebook",
                                selectedToken: "token-input-selected-token-facebook",
                                highlightedToken: "token-input-highlighted-token-facebook",
                                dropdown: "token-input-dropdown-facebook",
                                dropdownItem: "token-input-dropdown-item-facebook",
                                dropdownItem2: "token-input-dropdown-item2-facebook",
                                selectedDropdownItem: "token-input-selected-dropdown-item-facebook",
                                inputToken: "token-input-input-token-facebook"
                            }
                        });
     $('#users').bind('tokenDeleted',function(e, id, name){
                            $.post(url, { _method: 'delete', id: id});
     });
    
    zzcontacts.init( zz.current_user_id, {}, function(){
    $(".contacts-btn").each( function( index, button ){
        var service = $(button).attr('data-service');
        if( zzcontacts.is_service_linked(service)){
            $(button).find('div').removeClass('off sync error').addClass('on');
            $(button).attr( 'title', 'Last import on:'+zzcontacts.data[service].last_import);
        }
        $(button).click( function(e){
            e.preventDefault();
            $(button).attr('disabled', 'disabled');
            $(button).find('div').removeClass('off on error').addClass('sync');
            var onSuccess = function(){
                $(button).find('div').removeClass('off sync error').addClass('on');
                $(button).attr( 'title', 'Last imported a moment ago.');
                $(button).removeAttr('disabled');
            };
            var onError = function(error_src,error_msg){
                $(button).find('div').removeClass('off sync on').addClass('error');
                $(button).attr( 'title', 'There was an error: '+error_msg+'. Please try again later.');
                $(button).removeAttr('disabled');
            };
            zzcontacts.import_contacts(service, onSuccess, onError);
        });
    });
    }, function(){} );


    $('#contacts_submit').click( function(e){
        e.preventDefault();

        $.ajax({ type: 'POST',
            url:  url,
            data: $('#contacts_form').serialize(),
            error: function(){ alert("post failed"); },
            success: function (){
                $.ajax({ type: 'GET',
                    url: url,
                    dataType: 'json',
                    error: function(){ alert("get failed"); },
                    success: function ( json ){
                        var list = $('#users').data( 'tokeninput').list;
                        list.empty();
                        for ( var i=0, len=json.length; i<len; ++i ){
                            list.add_token( json[i].id, json[i].name );
                        }
                    }
                });
            }
        });
    })


});
</script>

</body>
</html>

